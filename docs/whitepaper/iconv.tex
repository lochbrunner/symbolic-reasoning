\def\ConvColor{rgb:yellow,5;red,2.5;white,5}
\def\ConvReluColor{rgb:yellow,5;red,5;white,5}

% keine batch
\begin{tikzpicture}
\tikzstyle{connection}=[ultra thick,every node/.style={sloped,allow upside down},draw=\edgecolor,opacity=0.7]

\pic[shift={(0,0,0)}] at (0,0,0) {RightBandedBox={name=ix,caption=x,%
        xlabel={{"t", "f"}},ylabel=L,zlabel=,fill=\ConvColor,bandfill=\ConvColor,%
        height=8,width={2, 3},depth=8}};

\pic[shift={(0,3,0)}] at (0,0,0) {Box={name=i1,caption=g,%
        xlabel={{"K"}},ylabel=L,zlabel=,fill=\ConvColor,%
        height=8,width={2},depth=8}};

\pic[shift={(2,0,0)}] at (ix-east) {RightBandedBox={name=ic1,caption=iconv,%
        xlabel={{"I"}},ylabel=L,zlabel=,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=10,width={3},depth=10}};

\pic[shift={(4,0,0)}] at (ix-east) {RightBandedBox={name=ic2,caption=iconv,%
        xlabel={{"I"}},ylabel=L,zlabel=,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=10,width={3},depth=10}};

% heads

\pic[shift={(8,0,-4)}] at (ix-east) {RightBandedBox={name=icv,caption=iconv,%
xlabel={{"I"}},ylabel=L,zlabel=,fill=\ConvColor,bandfill=\ConvReluColor,%
height=10,width={3},depth=10}};

\coordinate (ov) at (11,0,-4) {};
\draw [fill=orange] (11 , 0.2 , -3.8) -- (11 ,-0.2 , -3.8) -- (11 ,-0.2 , -4.2) -- (11 , 0.2 , -4.2) -- cycle;
\node[draw, draw=white] at (11,-1.3,-4) {\bf value};
% \pic[shift={(10,0,-4)}] at (ix-east) {Box={name=ov,caption=value,%
% xlabel={{"1"}},zlabel=,ylabel=1,fill=\ConvColor,%
% height=1,width={1},depth=1}};

\pic[shift={(8,0,4)}] at (ix-east) {RightBandedBox={name=icp,caption=iconv,%
        xlabel={{"I", "dummy"}},ylabel=L,zlabel=,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=10,width={3},depth=10}};

% \pic[shift={(10,0,4)}] at (ix-east) {Box={name=op,caption=policy,%
%         xlabel={{"r", "dummy"}},ylabel=L,zlabel=,fill=\ConvColor,%
%         height=10,width={8},depth=10}};

\coordinate (op) at (11,0,4) {};
\node[draw, draw=white] at (11,-2.3,4) {\bf policy};
\draw [] (11 , 1 , 3) -- (11 ,-1 , 3) -- (11 ,-1 , 5) -- (11 , 1 , 5) -- cycle;
\foreach \r/\p/\v in {
        0/2/0, 1/0/19, 2/0/11, 3/0/31, 4/0/26, 5/1/18, 5/3/66, 5/4/61, 5/2/46, 5/5/59, 5/6/48, 6/2/37, 7/1/46, 7/3/78, 7/4/100, 7/2/48, 7/5/70, 7/6/60
} {
        \draw[fromColorBar=\v] (11 , 1-\r*0.25 , 5-\p*0.3) -- (11 , 0.8-\r*0.25 , 5-\p*0.3) -- (11 ,0.8-\r*0.25 , 4.8-\p*0.3) -- (11 , 1-\r*0.25 , 4.8-\p*0.3) -- cycle; ;
}


\path (ix-east) -- (ix-west) coordinate[pos=0.4] (after4) ;

\draw [connection] (ix-east) -- node {\midarrow} (ic1-west);
\draw [connection]  (ic1-east) -- node {\midarrow} (ic2-west);
\draw [connection]  (ic2-east) -- node {\midarrow} (icv-west);
\draw [connection]  (icv-east) -- node {\midarrow} (ov);
\draw [connection]  (ic2-east) -- node {\midarrow} (icp-west);
\draw [connection]  (icp-east) -- node {\midarrow} (op);

\draw [connection] (i1-east) -- ++ (2.5,0,0) -- node {\midarrow} (ic1-west);
\draw [connection] (i1-east) -- ++ (4.5,0,0) -- node {\midarrow} (ic2-west);
\draw [connection] (i1-east) -- ++ (5,0,0) -- ++ (3.5, 0, -4) -- node {\midarrow} (icv-west);
\draw [connection] (i1-east) -- ++ (5,0,0) -- ++ (3.5, 0, +4) -- node {\midarrow} (icp-west);

\end{tikzpicture}
